// üìÅ prisma/schema.prisma - COMPLETE UPDATED VERSION

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextIndex", "fullTextSearch"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ============================================
// USER & AUTH
// ============================================

model User {
  id                   String               @id @default(cuid())
  email                String               @unique
  password             String?
  firstName            String
  lastName             String?
  phone                String?
  avatar               String?
  status               UserStatus           @default(PENDING_VERIFICATION)
  emailVerified        Boolean              @default(false)
  emailVerifyToken     String?
  emailVerifyExpires   DateTime?
  passwordResetToken   String?
  passwordResetExpires DateTime?
  googleId             String?              @unique
  otpSecret            String?
  otpEnabled           Boolean              @default(false)
  lastLoginAt          DateTime?
  lastLoginIp          String?
  createdAt            DateTime             @default(now())
  updatedAt            DateTime             @updatedAt
  
  // Relations
  activityLogs         ActivityLog[]
  notifications        Notification[]
  ownedOrganizations   Organization[]       @relation("OrganizationOwner")
  memberships          OrganizationMember[]
  refreshTokens        RefreshToken[]
  createdCampaigns     Campaign[]          @relation("CampaignCreator")
  createdChatbots      Chatbot[]           @relation("ChatbotCreator")

  @@index([email])
  @@index([googleId])
  @@index([status])
}

model RefreshToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  userAgent String?
  ipAddress String?
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@index([expiresAt])
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  PENDING_VERIFICATION
}

enum UserRole {
  OWNER
  ADMIN
  MEMBER
  VIEWER
}

// ============================================
// ORGANIZATION
// ============================================

model Organization {
  id               String               @id @default(cuid())
  name             String
  slug             String               @unique
  logo             String?
  website          String?
  industry         String?
  timezone         String               @default("UTC")
  ownerId          String
  planType         PlanType             @default(FREE)
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt
  
  // Relations
  owner            User                 @relation("OrganizationOwner", fields: [ownerId], references: [id])
  members          OrganizationMember[]
  whatsappAccounts WhatsAppAccount[]
  contacts         Contact[]
  contactGroups    ContactGroup[]
  templates        Template[]
  campaigns        Campaign[]
  conversations    Conversation[]
  chatbots         Chatbot[]
  automations      Automation[]
  webhooks         Webhook[]
  webhookLogs      WebhookLog[]
  apiKeys          ApiKey[]
  subscription     Subscription?
  notifications    Notification[]
  activityLogs     ActivityLog[]
  metaConnection   MetaConnection?
  oauthStates      OAuthState[]

  @@index([slug])
  @@index([ownerId])
  @@index([planType])
}

model OrganizationMember {
  id             String       @id @default(cuid())
  organizationId String
  userId         String
  role           UserRole     @default(MEMBER)
  invitedAt      DateTime     @default(now())
  joinedAt       DateTime?
  updatedAt      DateTime     @default(now()) @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([organizationId, userId])
  @@index([organizationId])
  @@index([userId])
  @@index([role])
}

enum PlanType {
  FREE
  STARTER
  PRO
  ENTERPRISE
}

// ============================================
// PLANS & BILLING
// ============================================

model Plan {
  id                   String         @id @default(cuid())
  name                 String
  type                 PlanType       @unique
  slug                 String         @unique
  description          String?
  monthlyPrice         Decimal        @db.Decimal(10, 2)
  yearlyPrice          Decimal        @db.Decimal(10, 2)
  
  // Limits
  maxContacts          Int
  maxMessages          Int
  maxTeamMembers       Int
  maxCampaigns         Int
  maxChatbots          Int
  maxTemplates         Int
  maxWhatsAppAccounts  Int
  maxMessagesPerMonth  Int
  maxCampaignsPerMonth Int
  maxAutomations       Int
  maxApiCalls          Int
  
  features             Json           @default("[]")
  isActive             Boolean        @default(true)
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt
  subscriptions        Subscription[]

  @@index([slug])
  @@index([isActive])
  @@index([type])
}

model Subscription {
  id                 String             @id @default(cuid())
  organizationId     String             @unique
  planId             String
  status             SubscriptionStatus @default(ACTIVE)
  billingCycle       String             @default("monthly")
  currentPeriodStart DateTime
  currentPeriodEnd   DateTime
  messagesUsed       Int                @default(0)
  contactsUsed       Int                @default(0)
  paymentMethod      String?
  lastPaymentAt      DateTime?
  nextPaymentAt      DateTime?
  cancelledAt        DateTime?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  organization       Organization       @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  plan               Plan               @relation(fields: [planId], references: [id])

  @@index([organizationId])
  @@index([status])
  @@index([currentPeriodEnd])
}

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  EXPIRED
  PAST_DUE
}

// ============================================
// WHATSAPP ACCOUNTS - ‚úÖ UPDATED
// ============================================

model WhatsAppAccount {
  id                      String                @id @default(cuid())
  organizationId          String
  phoneNumberId           String                @unique
  wabaId                  String
  phoneNumber             String
  displayName             String
  qualityRating           String?
  
  // Tokens
  accessToken             String?
  tokenExpiresAt          DateTime?
  
  // Webhook
  webhookSecret           String?
  
  // Status & Verification - ‚úÖ ADDED
  status                  WhatsAppAccountStatus @default(PENDING)
  codeVerificationStatus  String?               // VERIFIED, NOT_VERIFIED
  nameStatus              String?               // APPROVED, PENDING, REJECTED
  verifiedName            String?
  
  // Rate Limiting - ‚úÖ ADDED
  messagingLimit          String?               // TIER_50, TIER_250, TIER_1K, TIER_10K, TIER_100K, TIER_UNLIMITED
  dailyMessageLimit       Int                   @default(1000)
  dailyMessagesUsed       Int                   @default(0)
  lastLimitReset          DateTime              @default(now())
  
  // Business Profile - ‚úÖ ADDED
  businessProfile         Json?                 // Complete Meta business profile
  
  isDefault               Boolean               @default(false)
  createdAt               DateTime              @default(now())
  updatedAt               DateTime              @updatedAt
  
  // Relations
  organization            Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  templates               Template[]            // ‚úÖ ADDED
  campaigns               Campaign[]
  messages                Message[]
  messageQueue            MessageQueue[]        // ‚úÖ ADDED

  @@index([organizationId])
  @@index([wabaId])
  @@index([phoneNumberId])
  @@index([status])
}

enum WhatsAppAccountStatus {
  PENDING
  CONNECTED
  DISCONNECTED
  BANNED
  RESTRICTED
}

// ============================================
// META CONNECTION - ‚úÖ UPDATED
// ============================================

model MetaConnection {
  id                   String           @id @default(cuid())
  organizationId       String           @unique
  accessToken          String
  accessTokenExpiresAt DateTime?
  wabaId               String
  wabaName             String?
  businessId           String?
  status               ConnectionStatus @default(PENDING)
  lastSyncedAt         DateTime?
  errorMessage         String?
  webhookVerified      Boolean          @default(false)
  messagingLimit       String?
  qualityRating        String?
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt
  
  organization         Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  phoneNumbers         PhoneNumber[]

  @@index([organizationId])
  @@index([status])
  @@index([wabaId])
}

model PhoneNumber {
  id               String         @id @default(cuid())
  metaConnectionId String
  phoneNumberId    String         @unique
  phoneNumber      String
  displayName      String?
  qualityRating    String?
  verifiedName     String?
  isActive         Boolean        @default(true)
  isPrimary        Boolean        @default(false)
  messagesLimit    Int?
  messagesUsed     Int            @default(0)
  lastResetAt      DateTime       @default(now())
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  
  metaConnection   MetaConnection @relation(fields: [metaConnectionId], references: [id], onDelete: Cascade)
  conversations    Conversation[]

  @@index([isActive, isPrimary])
  @@index([metaConnectionId])
  @@index([phoneNumberId])
}

enum ConnectionStatus {
  PENDING
  CONNECTED
  DISCONNECTED
  ERROR
  TOKEN_EXPIRED
}

// ============================================
// OAUTH STATE - ‚úÖ NEW
// ============================================

model OAuthState {
  id             String       @id @default(cuid())
  state          String       @unique
  organizationId String
  expiresAt      DateTime
  createdAt      DateTime     @default(now())
  
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([state])
  @@index([expiresAt])
  @@index([organizationId])
}

// ============================================
// CONTACTS
// ============================================

model Contact {
  id               String               @id @default(cuid())
  organizationId   String
  phone            String
  countryCode      String               @default("+91")
  firstName        String?
  lastName         String?
  email            String?
  avatar           String?
  customFields     Json                 @default("{}")
  tags             String[]             @default([])
  status           ContactStatus        @default(ACTIVE)
  lastMessageAt    DateTime?
  messageCount     Int                  @default(0)
  source           String?
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt
  
  organization     Organization         @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  groupMemberships ContactGroupMember[]
  conversations    Conversation[]
  campaignContacts CampaignContact[]
  messageQueue     MessageQueue[]       // ‚úÖ ADDED

  @@unique([organizationId, phone])
  @@index([organizationId])
  @@index([phone])
  @@index([status])
  @@index([tags])
  @@index([lastMessageAt])
  @@index([createdAt])
}

model ContactGroup {
  id             String               @id @default(cuid())
  organizationId String
  name           String
  description    String?
  color          String?              @default("#25D366")
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  
  organization   Organization         @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  members        ContactGroupMember[]
  campaigns      Campaign[]

  @@unique([organizationId, name])
  @@index([organizationId])
}

model ContactGroupMember {
  id        String       @id @default(cuid())
  groupId   String
  contactId String
  addedAt   DateTime     @default(now())
  contact   Contact      @relation(fields: [contactId], references: [id], onDelete: Cascade)
  group     ContactGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@unique([groupId, contactId])
  @@index([groupId])
  @@index([contactId])
}

enum ContactStatus {
  ACTIVE
  BLOCKED
  UNSUBSCRIBED
}

// ============================================
// TEMPLATES - ‚úÖ COMPLETELY UPDATED
// ============================================

model Template {
  id                String           @id @default(cuid())
  organizationId    String
  
  // ‚úÖ CRITICAL: Link to specific WhatsApp Account
  whatsappAccountId String
  wabaId            String           // Meta WABA ID for syncing
  
  metaTemplateId    String?
  name              String
  language          String           @default("en")
  category          TemplateCategory @default(MARKETING)
  
  // Content
  headerType        String?
  headerContent     String?
  bodyText          String
  footerText        String?
  buttons           Json             @default("[]")
  variables         Json             @default("[]")
  
  // Status
  status            TemplateStatus   @default(PENDING)
  rejectionReason   String?
  
  // ‚úÖ NEW: Quality metrics
  qualityScore      String?          // HIGH, MEDIUM, LOW, UNKNOWN
  
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  
  // Relations
  organization      Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  whatsappAccount   WhatsAppAccount  @relation(fields: [whatsappAccountId], references: [id], onDelete: Cascade)
  campaigns         Campaign[]
  messageQueue      MessageQueue[]   // ‚úÖ ADDED

  // ‚úÖ UPDATED: Unique per WhatsApp Account
  @@unique([whatsappAccountId, name, language])
  @@index([organizationId])
  @@index([whatsappAccountId])
  @@index([wabaId])
  @@index([metaTemplateId])
  @@index([status])
  @@index([category])
}

enum TemplateCategory {
  MARKETING
  UTILITY
  AUTHENTICATION
}

enum TemplateStatus {
  PENDING
  APPROVED
  REJECTED
}

// ============================================
// CAMPAIGNS - ‚úÖ UPDATED
// ============================================

model Campaign {
  id                String            @id @default(cuid())
  organizationId    String
  name              String
  description       String?
  templateId        String
  whatsappAccountId String
  contactGroupId    String?
  audienceFilter    Json?
  status            CampaignStatus    @default(DRAFT)
  scheduledAt       DateTime?
  startedAt         DateTime?
  completedAt       DateTime?
  
  // Stats
  totalContacts     Int               @default(0)
  sentCount         Int               @default(0)
  deliveredCount    Int               @default(0)
  readCount         Int               @default(0)
  failedCount       Int               @default(0)
  
  // ‚úÖ NEW: Created by user
  createdById       String
  
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  
  // Relations
  organization      Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  template          Template          @relation(fields: [templateId], references: [id])
  whatsappAccount   WhatsAppAccount   @relation(fields: [whatsappAccountId], references: [id])
  contactGroup      ContactGroup?     @relation(fields: [contactGroupId], references: [id])
  createdBy         User              @relation("CampaignCreator", fields: [createdById], references: [id])
  campaignContacts  CampaignContact[]
  messageQueue      MessageQueue[]    // ‚úÖ ADDED

  @@index([organizationId])
  @@index([status])
  @@index([scheduledAt])
  @@index([createdAt])
  @@index([createdById])
}

enum CampaignStatus {
  DRAFT
  SCHEDULED
  RUNNING
  PAUSED
  COMPLETED
  FAILED
  CANCELLED
}

model CampaignContact {
  id            String        @id @default(cuid())
  campaignId    String
  contactId     String
  status        MessageStatus @default(PENDING)
  waMessageId   String?
  sentAt        DateTime?
  deliveredAt   DateTime?
  readAt        DateTime?
  failedAt      DateTime?
  failureReason String?
  retryCount    Int           @default(0)
  nextRetryAt   DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  
  campaign      Campaign      @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  contact       Contact       @relation(fields: [contactId], references: [id], onDelete: Cascade)

  @@unique([campaignId, contactId])
  @@index([campaignId])
  @@index([contactId])
  @@index([nextRetryAt])
  @@index([status])
}

// ============================================
// MESSAGE QUEUE - ‚úÖ NEW MODEL
// ============================================

model MessageQueue {
  id                String           @id @default(cuid())
  
  // References
  campaignId        String?
  contactId         String
  whatsappAccountId String
  templateId        String
  
  // Message details
  templateParams    Json?
  
  // Queue management
  status            QueueStatus      @default(PENDING)
  priority          Int              @default(0)
  
  // Retry logic
  retryCount        Int              @default(0)
  maxRetries        Int              @default(3)
  nextRetryAt       DateTime?
  
  // Results
  waMessageId       String?
  sentAt            DateTime?
  deliveredAt       DateTime?
  readAt            DateTime?
  failedAt          DateTime?
  errorMessage      String?
  errorCode         String?
  
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  
  // Relations
  campaign          Campaign?        @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  contact           Contact          @relation(fields: [contactId], references: [id], onDelete: Cascade)
  whatsappAccount   WhatsAppAccount  @relation(fields: [whatsappAccountId], references: [id])
  template          Template         @relation(fields: [templateId], references: [id])

  @@index([campaignId])
  @@index([contactId])
  @@index([whatsappAccountId])
  @@index([status])
  @@index([nextRetryAt])
  @@index([priority, createdAt])
  @@index([createdAt])
}

enum QueueStatus {
  PENDING
  PROCESSING
  SENT
  DELIVERED
  READ
  FAILED
  CANCELLED
  SKIPPED
}

// ============================================
// CONVERSATIONS - ‚úÖ UPDATED
// ============================================

model Conversation {
  id                    String       @id @default(cuid())
  organizationId        String
  contactId             String
  phoneNumberId         String?
  
  lastMessageAt         DateTime?
  lastMessagePreview    String?
  
  // ‚úÖ NEW: 24-hour messaging window tracking
  lastCustomerMessageAt DateTime?
  windowExpiresAt       DateTime?
  isWindowOpen          Boolean      @default(true)
  lastBotMessageAt      DateTime?
  
  isArchived            Boolean      @default(false)
  isRead                Boolean      @default(true)
  unreadCount           Int          @default(0)
  assignedTo            String?
  labels                String[]     @default([])
  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @updatedAt
  
  organization          Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  contact               Contact      @relation(fields: [contactId], references: [id], onDelete: Cascade)
  phoneNumber           PhoneNumber? @relation(fields: [phoneNumberId], references: [id])
  messages              Message[]

  @@unique([organizationId, contactId])
  @@index([organizationId])
  @@index([contactId])
  @@index([isWindowOpen])
  @@index([windowExpiresAt])
  @@index([lastMessageAt])
  @@index([assignedTo])
  @@index([isArchived])
  @@index([phoneNumberId])
}

model Message {
  id                String           @id @default(cuid())
  conversationId    String
  whatsappAccountId String?
  waMessageId       String?          @unique
  wamId             String?          @unique
  direction         MessageDirection
  type              MessageType      @default(TEXT)
  content           String?
  mediaUrl          String?
  mediaType         String?
  mediaMimeType     String?
  templateId        String?
  templateName      String?
  templateParams    Json?
  status            MessageStatus    @default(PENDING)
  sentAt            DateTime?
  deliveredAt       DateTime?
  readAt            DateTime?
  failedAt          DateTime?
  failureReason     String?
  replyToMessageId  String?
  metadata          Json?
  retryCount        Int              @default(0)
  statusUpdatedAt   DateTime?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  
  conversation      Conversation     @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  whatsappAccount   WhatsAppAccount? @relation(fields: [whatsappAccountId], references: [id])

  @@index([conversationId])
  @@index([wamId])
  @@index([waMessageId])
  @@index([direction])
  @@index([status])
  @@index([createdAt])
}

enum MessageDirection {
  INBOUND
  OUTBOUND
}

enum MessageType {
  TEXT
  IMAGE
  VIDEO
  AUDIO
  DOCUMENT
  STICKER
  LOCATION
  CONTACT
  TEMPLATE
  INTERACTIVE
}

enum MessageStatus {
  PENDING
  SENT
  DELIVERED
  READ
  FAILED
}

// ============================================
// CHATBOT - ‚úÖ UPDATED
// ============================================

model Chatbot {
  id              String        @id @default(cuid())
  organizationId  String
  name            String
  description     String?
  flowData        Json          @default("{}")
  triggerKeywords String[]      @default([])
  isDefault       Boolean       @default(false)
  welcomeMessage  String?
  fallbackMessage String?
  status          ChatbotStatus @default(DRAFT)
  
  // ‚úÖ NEW: Created by user
  createdById     String
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  organization    Organization  @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  createdBy       User          @relation("ChatbotCreator", fields: [createdById], references: [id])

  @@index([organizationId])
  @@index([status])
  @@index([isDefault])
  @@index([createdById])
}

enum ChatbotStatus {
  DRAFT
  ACTIVE
  PAUSED
}

// ============================================
// AUTOMATION
// ============================================

model Automation {
  id             String            @id @default(cuid())
  organizationId String
  name           String
  description    String?
  trigger        AutomationTrigger
  triggerConfig  Json              @default("{}")
  actions        Json              @default("[]")
  isActive       Boolean           @default(false)
  executionCount Int               @default(0)
  lastExecutedAt DateTime?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  
  organization   Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([trigger])
  @@index([isActive])
}

enum AutomationTrigger {
  NEW_CONTACT
  KEYWORD
  WEBHOOK
  SCHEDULE
  INACTIVITY
}

// ============================================
// WEBHOOKS & LOGS
// ============================================

model Webhook {
  id              String       @id @default(cuid())
  organizationId  String
  url             String
  secret          String?
  events          String[]     @default([])
  isActive        Boolean      @default(true)
  lastTriggeredAt DateTime?
  successCount    Int          @default(0)
  failureCount    Int          @default(0)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  
  organization    Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([isActive])
}

model WebhookLog {
  id             String        @id @default(cuid())
  organizationId String?
  source         String
  eventType      String
  payload        Json
  status         WebhookStatus @default(PENDING)
  processedAt    DateTime?
  responseTime   Int?
  errorMessage   String?
  createdAt      DateTime      @default(now())
  
  organization   Organization? @relation(fields: [organizationId], references: [id])

  @@index([organizationId])
  @@index([eventType])
  @@index([status])
  @@index([createdAt])
  @@index([source, eventType])
}

enum WebhookStatus {
  PENDING
  PROCESSING
  SUCCESS
  FAILED
}

// ============================================
// API KEYS
// ============================================

model ApiKey {
  id             String       @id @default(cuid())
  organizationId String
  name           String
  key            String       @unique
  secret         String
  permissions    String[]     @default([])
  rateLimit      Int          @default(100)
  lastUsedAt     DateTime?
  usageCount     Int          @default(0)
  isActive       Boolean      @default(true)
  expiresAt      DateTime?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([key])
  @@index([isActive])
}

// ============================================
// NOTIFICATIONS & ACTIVITY
// ============================================

model Notification {
  id             String        @id @default(cuid())
  userId         String
  organizationId String?
  type           String        @default("system")
  title          String
  description    String
  actionUrl      String?
  metadata       Json          @default("{}")
  read           Boolean       @default(false)
  readAt         DateTime?
  createdAt      DateTime      @default(now())
  
  user           User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization   Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, read])
  @@index([organizationId])
  @@index([type])
  @@index([createdAt])
}

model ActivityLog {
  id             String          @id @default(cuid())
  organizationId String?
  userId         String?
  entity         String?
  entityId       String?
  action         ActivityAction?
  metadata       Json            @default("{}")
  ipAddress      String?
  userAgent      String?
  createdAt      DateTime        @default(now())
  
  user           User?           @relation(fields: [userId], references: [id])
  organization   Organization?   @relation(fields: [organizationId], references: [id])

  @@index([organizationId])
  @@index([userId])
  @@index([entity, entityId])
  @@index([createdAt])
}

enum ActivityAction {
  CREATE
  UPDATE
  DELETE
  VIEW
  LOGIN
  LOGOUT
  EXPORT
  IMPORT
  SEND
  RECEIVE
}

// ============================================
// ADMIN
// ============================================

model AdminUser {
  id          String    @id @default(cuid())
  email       String    @unique
  password    String
  name        String
  role        String    @default("admin")
  isActive    Boolean   @default(true)
  lastLoginAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([email])
  @@index([role])
  @@index([isActive])
}